<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumo Interativo: Probabilidade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* == Cores do Tema (Base) == */
            --probabilidade-color: #4f46e5;      /* Indigo-600 */
            --avancado-color: #059669;     /* Emerald-600 (Prob. Avançada) */
            --conceitos-color: #d97706;         /* Amber-600 (Combinatória) */

            /* == MODO ESCURO == */

            /* Glow/Highlight Colors for dark theme */
            --probabilidade-glow: rgba(79, 70, 229, 0.2);
            --avancado-glow: rgba(5, 150, 105, 0.2);
            --conceitos-glow: rgba(217, 119, 6, 0.2);
            
            /* Theme Border Colors for dark theme */
            --probabilidade-border: rgba(99, 102, 241, 0.4); /* Indigo-400 */
            --avancado-border: rgba(52, 211, 153, 0.4); /* Emerald-400 */
            --conceitos-border: rgba(245, 158, 11, 0.4); /* Amber-400 */

            /* Dark Theme Palette */
            --bg-main: #111827; /* gray-900 */
            --text-primary: #f3f4f6; /* gray-100 */
            --text-secondary: #9ca3af; /* gray-400 */
        }

        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; 
            color: var(--text-primary); /* Alterado */
            overflow-x: hidden;
            background-color: var(--bg-main); /* Alterado */
            transition: background-color 0.5s ease-in-out;
        }
        
        /* == Background color flash for Quiz (Dark) == */
        body.correct-bg { background-color: #062e1e; } /* emerald-950 */
        body.incorrect-bg { background-color: #450a0a; } /* red-950 */

        /* Animated background shapes */
        .background-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            overflow: hidden;
            z-index: -2;
        }
        .light-bubble {
            position: absolute;
            border-radius: 50%;
            filter: blur(140px);
            opacity: 0.15; 
            animation: moveBubble 35s infinite alternate;
        }
        .light-bubble.b1 { width: 45vw; height: 45vw; top: 5%; left: -10%; background: var(--probabilidade-color); animation-duration: 40s; }
        .light-bubble.b2 { width: 45vw; height: 45vw; top: 40%; left: 70%; background: var(--conceitos-color); animation-duration: 35s; }
        .light-bubble.b3 { width: 50vw; height: 50vw; top: 60%; left: 10%; background: var(--avancado-color); animation-duration: 45s; }

        @keyframes moveBubble {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(15vw, -20vh) scale(1.2); }
        }
        
        /* Dynamic background glows */
        .dynamic-bg-glow {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 150vmax;
            height: 150vmax;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0;
            transition: opacity 1.5s ease-in-out;
            z-index: -1;
        }
        #bg-conceitos-fundamentais { background-color: var(--probabilidade-color); }
        #bg-analise-combinatoria { background-color: var(--conceitos-color); }
        #bg-probabilidade-avancada { background-color: var(--avancado-color); }

        .section-container {
            width: 100%;
            padding: 7rem 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            position: relative;
            z-index: 1;
        }
        
        #hero { 
            min-height: 90vh; 
            padding-top: 2rem; 
            padding-bottom: 2rem;
        }
        #hero h1 { 
            font-size: clamp(2.8rem, 7vw, 5rem); 
            font-weight: 800; 
            letter-spacing: -0.05em; 
            text-shadow: 0 0 20px rgba(255,255,255,0.05); /* Alterado */
        }
        #hero p { 
            font-size: clamp(1.1rem, 2.5vw, 1.35rem); 
            max-width: 650px; 
            color: var(--text-secondary);
            margin-left: auto;
            margin-right: auto;
        }

        /* == Cards (Dark Glass) == */
        .section-header-card {
            position: relative;
            background: rgba(31, 41, 55, 0.35); /* gray-800 com opacidade */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1); /* Borda clara sutil */
            border-radius: 1.5rem;
            padding: 2.5rem;
            margin-bottom: 3rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2); /* Sombra mais escura */
            text-align: center;
            max-width: 1200px;
            width: 100%;
            overflow: hidden;
            z-index: 2;
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.5s ease-out, transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .section-header-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .section-header-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            pointer-events: none;
            box-shadow: inset 0 0 0 1.5px rgba(255, 255, 255, 0.15); /* Destaque interno claro */
            z-index: 1;
        }
        .section-header-card > * {
             position: relative;
             z-index: 2;
        }
        .section-header-card .section-title {
            margin-bottom: 1rem;
        }
        #hero .section-header-card { margin-bottom: 0; } 

        .section-title { font-size: clamp(2.2rem, 5.5vw, 4rem); font-weight: 800; letter-spacing: -0.04em; color: var(--text-primary); position: relative; }
        .section-subtitle { 
            font-size: clamp(1rem, 2vw, 1.2rem); 
            max-width: 700px; 
            color: var(--text-secondary); 
            margin-bottom: 0;
            margin-left: auto; 
            margin-right: auto; 
        }

        .topics-grid {
            width: 100%;
            max-width: 1200px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            align-items: start;
        }

        /* == Topic Cards (Dark Glass) == */
        .topic-card {
            position: relative;
            background: rgba(31, 41, 55, 0.35); /* gray-800 com opacidade */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            transition: all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            overflow: hidden;
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.5s ease-out, transform 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        .topic-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .topic-card:nth-child(1) { transition-delay: 0.05s; }
        .topic-card:nth-child(2) { transition-delay: 0.1s; }
        .topic-card:nth-child(3) { transition-delay: 0.15s; }
        .topic-card:nth-child(4) { transition-delay: 0.2s; }
        .topic-card:nth-child(5) { transition-delay: 0.25s; }

        .topic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            pointer-events: none;
            box-shadow: inset 0 0 0 1.5px rgba(255, 255, 255, 0.15);
            transition: box-shadow 0.4s ease;
            z-index: 1;
        }
        
        .topic-card:hover::before { 
            box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.25);
        }
        
        .topic-card > div {
            position: relative;
            z-index: 2;
        }

        .topic-card:hover { 
            transform: translateY(-5px);
            border-color: rgba(255, 255, 255, 0.15); 
        }
        
        .topic-card .summary { 
            color: var(--text-primary); /* Alterado */
            text-shadow: none;
            font-size: 1.125rem; 
            font-weight: 600; 
            padding: 1.5rem; 
            cursor: pointer; 
            outline: none; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .topic-card .summary::after { 
            content: '+'; 
            font-size: 1.5rem; 
            font-weight: 400; 
            color: var(--text-secondary);
            text-shadow: none;
            transition: transform 0.3s ease-in-out; 
        }
        .topic-card.is-open > .summary::after { transform: rotate(45deg); }
        .topic-card.is-open > .summary { 
            border-bottom: 1px solid rgba(255, 255, 255, 0.15); /* Alterado */
        }
        
        .topic-content-wrapper {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out;
        }
        .topic-content { 
            padding: 1.5rem; 
            font-size: 0.95rem; 
            color: var(--text-secondary);
            text-shadow: none;
            line-height: 1.7;
        }
        .topic-content code {
            font-family: 'monospace';
            background-color: rgba(255,255,255,0.1); /* Alterado */
            padding: 0.2rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-primary); /* Alterado */
        }
        
        /* Fundo de exemplo (Dark) */
        .topic-content .bg-indigo-50,
        .topic-content .bg-amber-50,
        .topic-content .bg-emerald-50 {
            background-color: #1f2937 !important; /* gray-800 */
            color: var(--text-primary);
        }
        
        /* Bordas de destaque por seção */
        #conceitos-fundamentais .topic-card.is-open {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15), inset 0 0 0 2px var(--probabilidade-border);
        }
        #analise-combinatoria .topic-card.is-open {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15), inset 0 0 0 2px var(--conceitos-border);
        }
        #probabilidade-avancada .topic-card.is-open {
            box-shadow: 0 8px 25px rgba(0,0,0,0.15), inset 0 0 0 2px var(--avancado-border);
        }
        
        #conceitos-fundamentais .topic-card.is-open:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.2), inset 0 0 0 2px rgba(99, 102, 241, 0.6);
        }
        #analise-combinatoria .topic-card.is-open:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.2), inset 0 0 0 2px rgba(245, 158, 11, 0.6);
        }
        #probabilidade-avancada .topic-card.is-open:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.2), inset 0 0 0 2px rgba(52, 211, 153, 0.6);
        }
        
        /* == Termos (Dark) == */
        .term { 
            text-decoration: none; 
            cursor: pointer; 
            font-weight: 500;
            padding: 4px 10px;
            border-radius: 0.6rem;
            transition: all 0.2s ease-in-out;
            text-shadow: none;
        }
        #conceitos-fundamentais .term { background-color: var(--probabilidade-glow); color: #a5b4fc; } /* indigo-300 */
        #analise-combinatoria .term { background-color: var(--conceitos-glow); color: #fcd34d; } /* amber-300 */
        #probabilidade-avancada .term { background-color: var(--avancado-glow); color: #6ee7b7; } /* emerald-300 */
        .term:hover { 
            filter: brightness(1.25); 
        }

        /* == Modal Styling (Dark) == */
        #modal-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(17, 24, 39, 0.5); /* gray-900 com opacidade */
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0s linear 0.4s;
            z-index: 1000;
        }
        #modal-overlay.visible {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.4s ease;
        }
        
        #modal-content {
            background: rgba(31, 41, 55, 0.55); /* gray-800 com opacidade */
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
            border-radius: 2rem;
            position: relative;
            width: 90%;
            max-width: 500px;
            transform: scale(0.95);
            transition: transform 0.4s ease;
            overflow: hidden; 
            max-height: 90vh; /* Para modais de ajuda longos */
            display: flex; /* Para permitir scroll interno */
            flex-direction: column; /* Para empilhar header e description */
        }
        
        #modal-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: inherit;
            pointer-events: none;
            box-shadow: inset 0 0 0 1.5px rgba(255, 255, 255, 0.2);
            z-index: 1;
        }

        #modal-overlay.visible #modal-content { 
            transform: scale(1);
        }
        
        #modal-content.theme-probabilidade { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25), inset 0 0 0 2px var(--probabilidade-border); }
        #modal-content.theme-avancado { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25), inset 0 0 0 2px var(--avancado-border); }
        #modal-content.theme-conceitos { box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25), inset 0 0 0 2px var(--conceitos-border); }
        
        #modal-header, #modal-description {
            position: relative;
            z-index: 2;
        }

        #modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.15); /* Alterado */
            background: transparent;
            text-align: center;
            padding: 1.5rem 3.5rem;
            flex-shrink: 0; /* Header não encolhe */
        }
        
        #modal-title { 
            font-size: 1.75rem; 
            font-weight: 700; 
            text-shadow: none;
        }
        #modal-header.theme-probabilidade #modal-title { color: #c7d2fe; } /* indigo-200 */
        #modal-header.theme-avancado #modal-title { color: #a7f3d0; } /* emerald-200 */
        #modal-header.theme-conceitos #modal-title { color: #fcd34d; } /* amber-300 */
        
        #modal-description { 
            font-size: 1.05rem; 
            color: var(--text-secondary); 
            line-height: 1.7; 
            padding: 1.5rem 2rem 2rem 2rem;
            overflow-y: auto; /* Permite scroll se o conteúdo for grande */
        }
        #modal-description strong {
            color: var(--text-primary);
            font-weight: 600;
        }
        
        /* Botões de confirmação (Dark) */
        .modal-button-group {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }
        .modal-button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }
        .modal-button-confirm {
            background-color: var(--probabilidade-color);
            color: white;
        }
        .modal-button-confirm:hover {
            filter: brightness(1.1);
        }
        .modal-button-cancel {
            background-color: rgba(255,255,255,0.1); /* Alterado */
            color: var(--text-secondary);
        }
        .modal-button-cancel:hover {
            background-color: rgba(255,255,255,0.15); /* Alterado */
        }

        #modal-image-container { /* Mantido para compatibilidade, mas não usado */
            padding: 1.5rem;
            display: flex;
            justify-content: center;
        }

        #modal-close-btn {
            position: absolute;
            top: 1rem; right: 1rem;
            background: rgba(255,255,255,0.1); /* Alterado */
            border: none;
            border-radius: 50%;
            width: 2.5rem; height: 2.5rem;
            cursor: pointer; 
            transition: background-color 0.2s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: var(--text-secondary);
            z-index: 3;
        }
        #modal-close-btn:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); } /* Alterado */
        
        .footer-signature { text-align: center; padding: 4rem 1rem; background-color: transparent; color: #6b7280; } /* gray-500 */
        ul { list-style-position: inside; padding-left: 0.5rem;}
        li { margin-bottom: 0.5rem; }

        /* == Quiz Styles (Dark) == */
        #quiz-section {
             background: rgba(0, 0, 0, 0.2); /* Alterado */
             backdrop-filter: blur(15px);
             -webkit-backdrop-filter: blur(15px);
             border-top: 1px solid rgba(255, 255, 255, 0.1); /* Alterado */
             padding-bottom: 4rem;
        }

        .quiz-container {
            max-width: 800px;
            width: 100%;
            background: rgba(31, 41, 55, 0.5); /* gray-800 com opacidade */
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            padding: 2.5rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            position: relative;
        }
        
        #progress-bar-container {
            width: 100%;
            max-width: 800px;
            background-color: rgba(55, 65, 81, 0.4); /* gray-700 com opacidade */
            border-radius: 9999px;
            padding: 0.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #progress-bar-fill {
            height: 1.5rem;
            background: linear-gradient(90deg, var(--avancado-color), var(--probabilidade-color));
            border-radius: 9999px;
            transition: width 0.5s ease-in-out;
            text-align: center;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
        }
        #progress-label {
            text-align: center;
            margin-top: 0.75rem;
            margin-bottom: 2rem;
            font-weight: 500;
            color: var(--text-secondary);
        }
        
        #question-counter-display {
            position: absolute;
            top: 2.5rem;
            right: 2.5rem;
            width: auto;
            min-width: 44px;
            height: 44px;
            padding: 0 0.5rem;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            color: var(--text-primary);
            transition: all 0.3s ease;
            background-color: var(--text-secondary);
        }
        
        #help-btn {
            position: absolute;
            top: 2.5rem;
            left: 2.5rem;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: rgba(255,255,255,0.05); /* Alterado */
            border: 2px solid var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #help-btn:hover {
            transform: scale(1.1);
            background-color: rgba(255,255,255,0.1); /* Alterado */
            border-color: var(--text-primary);
            color: var(--text-primary);
        }
        
        #quiz-question {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2rem;
            padding: 0 96px; 
            text-align: center;
        }
        
        #quiz-options {
            list-style: none;
            padding: 0;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .quiz-option {
            background-color: rgba(55, 65, 81, 0.7); /* gray-700 com opacidade */
            border: 1px solid rgba(255,255,255,0.05); /* Alterado */
            border-radius: 1rem;
            padding: 1.25rem;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s ease-out, box-shadow 0.2s ease-out, background-color 0.2s ease-out;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            will-change: transform, box-shadow;
            color: var(--text-primary);
        }

        .quiz-option:hover {
            transform: translateY(-3px);
            background-color: #4b5563; /* gray-600 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.15), 0 4px 6px -4px rgba(0, 0, 0, 0.15);
        }
        
        .quiz-option.disabled { cursor: not-allowed; opacity: 0.7; }
        .quiz-option.correct-answer {
            border-color: #22c55e;
            background-color: #064e3b; /* emerald-900 */
            color: #d1fae5; /* emerald-100 */
            font-weight: 600;
        }
        .quiz-option.incorrect-answer {
            border-color: #ef4444;
            background-color: #7f1d1d; /* red-900 */
            color: #fee2e2; /* red-100 */
            font-weight: 600;
        }
        
        /* == Botões (Dark) == */
        #quiz-start-btn, #restart-quiz-btn {
            background: rgba(55, 65, 81, 0.4); /* gray-700 com opacidade */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            font-weight: 700;
            padding: 1rem 2.5rem;
            border-radius: 1rem;
            font-size: 1.2rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            color: var(--text-primary); /* Alterado */
        }
        
        #quiz-start-btn:disabled { 
            cursor: not-allowed; 
            background: rgba(55, 65, 81, 0.2);
            color: #6b7280; /* gray-500 */
        }

        #restart-quiz-btn {
            color: #a5b4fc; /* indigo-300 */
            margin-top: 2rem;
        }
        
        #reset-progress-btn {
            color: #9ca3af; /* gray-400 */
            background: none;
            font-size: 0.9rem;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        #quiz-start-btn:hover, #restart-quiz-btn:hover {
            transform: scale(1.05);
            background: rgba(55, 65, 81, 0.6); /* gray-700 */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        #reset-progress-btn:hover {
             color: var(--text-primary);
             text-decoration: underline;
        }
        
        #quiz-results { text-align: center; }
        
        #quiz-results h3 {
             font-size: 2rem;
             font-weight: 700;
             margin-bottom: 1.5rem;
        }

        #quiz-percentage {
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 2rem;
            width: 150px;
            height: 150px;
            background: rgba(55, 65, 81, 0.4); /* gray-700 com opacidade */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            margin-right: auto;
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .results-stats {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 2.5rem;
            font-size: 1.1rem;
        }
        
        .stat-correct, .stat-incorrect {
            font-weight: 600;
            color: var(--text-primary);
            padding: 0.5rem 1.25rem;
            border-radius: 9999px;
            transition: all 0.2s ease-in-out;
        }

        .stat-correct { background-color: rgba(34, 197, 94, 0.25); }
        .stat-incorrect { background-color: rgba(239, 68, 68, 0.25); }
        
        #missed-topics-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.75rem;
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }

        .missed-topic-bubble {
            background-color: #374151; /* gray-700 */
            color: var(--text-secondary);
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .missed-topic-bubble:hover {
            background-color: #4b5563; /* gray-600 */
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .missed-topic-bubble.visited-topic {
            border-color: #22c55e;
            background-color: #064e3b; /* emerald-900 */
            color: #a7f3d0; /* emerald-200 */
        }

    </style>
</head>
<body>
    <!-- Conteúdo da Página -->
    <div class="background-container">
        <div class="light-bubble b1"></div>
        <div class="light-bubble b2"></div>
        <div class="light-bubble b3"></div>
        <div class="dynamic-bg-glow" id="bg-conceitos-fundamentais"></div>
        <div class="dynamic-bg-glow" id="bg-analise-combinatoria"></div>
        <div class="dynamic-bg-glow" id="bg-probabilidade-avancada"></div>
    </div>

    <section id="hero" class="section-container">
        <div class="section-header-card">
            <h1>Probabilidade: Conceitos e Tópicos Avançados</h1>
            <p class="mt-4">Uma jornada interativa pelos conceitos fundamentais e avançados da Teoria da Probabilidade, baseada nos slides da Prof. Roberta.</p>
        </div>
    </section>
    
    <section id="conceitos-fundamentais" class="section-container">
        <div class="section-header-card">
            <h2 class="section-title">Probabilidade (Parte 1): Conceitos Fundamentais</h2>
            <p class="section-subtitle">A base da probabilidade: do que estamos falando? Aprenda sobre os pilares que definem o cálculo de chances.</p>
        </div>
        <div class="topics-grid">
            <div class="topic-card" id="topic-exp-espaco-evento">
                <div class="summary">Experimentos, Espaço Amostral e Eventos</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Tudo começa com três definições básicas:</p>
                        <ul>
                            <li><strong><span class="term" data-description="Um experimento que pode resultar em diferentes resultados, mesmo que repetido da mesma maneira. Ex: Lançar um dado.">Experimento Aleatório (E)</span>:</strong> Um processo que, quando repetido, pode levar a resultados diferentes e imprevisíveis.
                                <br><em>Ex: Lançar um dado, retirar uma carta de um baralho.</em>
                            </li>
                            <li><strong><span class="term" data-description="O conjunto de TODOS os resultados possíveis de um experimento aleatório. Representado por S ou Ω.">Espaço Amostral (S ou Ω)</span>:</strong> O conjunto de <strong>todos</strong> os resultados possíveis de um experimento.
                                <br><em>Ex (Dado): S = {1, 2, 3, 4, 5, 6}</em>
                                <br><em>Ex (Moeda): S = {Cara, Coroa}</em>
                            </li>
                            <li><strong><span class="term" data-description="Qualquer subconjunto de um espaço amostral. É o resultado específico que estamos interessados em medir.">Evento</span>:</strong> Um subconjunto do espaço amostral. É o "resultado de interesse".
                                <br><em>Ex (Dado): Evento A = "Sair número par" -> A = {2, 4, 6}</em>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-operacoes-eventos">
                <div class="summary">Operações com Eventos (União, Interseção, Complemento)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Podemos combinar eventos usando operações de conjuntos:</p>
                        <ul>
                            <li><strong><span class="term" data-description="Evento A 'OU' Evento B. Consiste nos elementos que pertencem a A, a B, ou a ambos.">União (A ∪ B)</span>:</strong> Representa a ocorrência do evento A <strong>OU</strong> do evento B.
                                <br><em>Ex: A={Par}, B={>4}. A ∪ B = {2, 4, 5, 6}</em>
                            </li>
                            <li><strong><span class="term" data-description="Evento A 'E' Evento B. Consiste nos elementos que pertencem a A e a B simultaneamente.">Interseção (A ∩ B)</span>:</strong> Representa a ocorrência do evento A <strong>E</strong> do evento B.
                                <br><em>Ex: A={Par}, B={>4}. A ∩ B = {6}</em>
                            </li>
                            <li><strong><span class="term" data-description="Evento 'NÃO A'. Consiste em todos os elementos do espaço amostral (S) que não estão em A.">Complemento (Aᶜ ou $\overline{A}$)</span>:</strong> Representa a <strong>não ocorrência</strong> do evento A.
                                <br><em>Ex: S={1,2,3,4,5,6}, A={Par}. Aᶜ = {1, 3, 5} (Ímpar)</em>
                            </li>
                            <li><strong><span class="term" data-description="Eventos que não podem ocorrer ao mesmo tempo. A interseção é vazia (A ∩ B = Ø).">Eventos Mutuamente Exclusivos</span>:</strong> São eventos que não possuem interseção (A ∩ B = Ø). A ocorrência de um impede a do outro.
                                <br><em>Ex: "Sair Par" e "Sair Ímpar" em um dado.</em>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-prob-classica">
                <div class="summary">Conceito-Chave: Probabilidade Clássica (Laplace)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Esta é a fórmula mais comum, usada quando o espaço amostral é <strong>finito</strong> e <strong>equiprovável</strong> (todos os resultados têm a mesma chance).</p>
                        <p class="text-center font-medium my-4 p-4 bg-gray-800 rounded-lg">
                            P(A) = <span class="text-lg">f / n</span>
                        </p>
                        <ul>
                            <li><strong>f =</strong> Número de <span class="term" data-description="O número de resultados que satisfazem o evento desejado. É 'o que eu quero que aconteça'.">Casos Favoráveis</span> (o que eu quero).</li>
                            <li><strong>n =</strong> Número de <span class="term" data-description="O número total de resultados possíveis (o tamanho do Espaço Amostral S). É 'tudo o que pode acontecer'.">Casos Possíveis</span> (o total).</li>
                        </ul>
                        <p class="font-semibold text-gray-300 mt-4">Exemplo (Soma de 2 Dados):</p>
                        <p>P(Soma das faces = 7)?</p>
                        <ul>
                            <li><strong>Total de Casos (n):</strong> 6 faces no Dado 1 × 6 faces no Dado 2 = 36 casos.</li>
                            <li><strong>Casos Favoráveis (f):</strong> { (1,6), (2,5), (3,4), (4,3), (5,2), (6,1) } -> 6 casos.</li>
                            <li><strong>Probabilidade:</strong> P = 6 / 36 = 1 / 6.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-outras-definicoes">
                <div class="summary">Outras Definições: Frequência Relativa e Axiomática</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Existem outras formas de definir probabilidade:</p>
                        <ul>
                            <li><strong><span class="term" data-description="Probabilidade 'a posteriori'. Baseia-se na frequência observada de um evento após 'n' repetições. P(A) ≈ n(A) / n.">Frequência Relativa</span>:</strong> Usada na prática. Repete-se o experimento 'n' vezes (n grande). A probabilidade é a frequência com que o evento A ocorreu.
                                <br><code>fr(A) = n(A) / n</code>
                                <br>Conforme <code>n → ∞</code>, <code>fr(A)</code> se aproxima de <code>P(A)</code>.
                            </li>
                            <li><strong><span class="term" data-description="Definição moderna que define a probabilidade por 3 regras (axiomas) que ela deve obedecer.">Conceito Axiomático</span>:</strong> Define a probabilidade por 3 regras (axiomas) que ela deve satisfazer:
                                <ol>
                                    <li><code>P(A) ≥ 0</code> (Probabilidade não é negativa)</li>
                                    <li><code>P(S) = 1</code> (A probabilidade do espaço amostral é 100%)</li>
                                    <li>Se A e B são <span class="term" data-description="Eventos que não podem ocorrer ao mesmo tempo. A interseção é vazia (A ∩ B = Ø).">mutuamente exclusivos</span>, então <code>P(A ∪ B) = P(A) + P(B)</code>.</li>
                                </ol>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-teoremas-importantes">
                <div class="summary">Teoremas Importantes (Regra da Soma, Complementar)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Dos axiomas, derivamos teoremas úteis:</p>
                        <ul>
                            <li><strong><span class="term" data-description="A probabilidade de um evento impossível (conjunto vazio Ø) é zero.">Probabilidade do Vazio</span>:</strong> <code>P(Ø) = 0</code></li>
                            <li><strong><span class="term" data-description="P(não A) = 1 - P(A). Muito útil para calcular 'pelo menos um'.">Regra do Complementar</span>:</strong> A probabilidade de algo <strong>não</strong> acontecer é 1 menos a probabilidade de acontecer.
                                <br><code>P(Aᶜ) = 1 - P(A)</code>
                            </li>
                            <li><strong><span class="term" data-description="P(A ou B) = P(A) + P(B) - P(A e B). Subtraímos a interseção para não contar duas vezes.">Regra da Soma (União)</span>:</strong> Para <strong>quaisquer</strong> dois eventos A e B:
                                <br><code>P(A ∪ B) = P(A) + P(B) - P(A ∩ B)</code>
                            </li>
                            <li><strong>Regra da Soma (3 eventos):</strong>
                                <br><code>P(A ∪ B ∪ C) = P(A) + P(B) + P(C) - P(A∩B) - P(A∩C) - P(B∩C) + P(A∩B∩C)</code>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NOVA SEÇÃO: ANÁLISE COMBINATÓRIA -->
    <section id="analise-combinatoria" class="section-container">
        <div class="section-header-card">
            <h2 class="section-title">Tópico de Apoio: Análise Combinatória</h2>
            <p class="section-subtitle">A arte de contar casos. Essencial para calcular o "Total de Casos" (n) e "Casos Favoráveis" (f) em problemas complexos.</p>
        </div>
        <div class="topics-grid">
            <div class="topic-card" id="topic-pfc">
                <div class="summary">Princípio Fundamental da Contagem (PFC)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Também chamado de "Princípio Multiplicativo". Se um evento é composto por várias etapas independentes, o número total de possibilidades é o <strong>produto</strong> das possibilidades de cada etapa.</p>
                        <p class="font-semibold text-gray-300 mt-4">Exemplo (Montar um Lanche):</p>
                        <p>Se você tem 3 tipos de pão, 2 tipos de queijo e 4 tipos de recheio, quantas combinações de lanche (1 pão, 1 queijo, 1 recheio) existem?</p>
                        <ul>
                            <li>Total = (Opções de Pão) × (Opções de Queijo) × (Opções de Recheio)</li>
                            <li>Total = 3 × 2 × 4 = 24 lanches possíveis.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-permutacao-arranjo">
                <div class="summary">Permutação e Arranjo (A Ordem Importa)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Usamos quando a <strong>ordem</strong> dos elementos <strong>importa</strong>.</p>
                        <ul>
                            <li><strong><span class="term" data-description="Usado para reordenar TODOS os 'n' elementos de um conjunto. Fórmula: P(n) = n! (n fatorial).">Permutação Simples (P<sub>n</sub>)</span>:</strong> Quantas filas (anagramas) podemos formar com 'n' elementos?
                                <br><code>P<sub>n</sub> = n!</code>
                                <br><em>Ex: Fila com 3 pessoas (A,B,C) -> 3! = 3*2*1 = 6 filas. (ABC, ACB, BAC, BCA, CAB, CBA)</em>
                            </li>
                            <li><strong><span class="term" data-description="Usado para escolher 'p' elementos de 'n' e ordená-los. Fórmula: A(n,p) = n! / (n-p)!">Arranjo Simples (A<sub>n,p</sub>)</span>:</strong> Quantos grupos ordenados (pódios, senhas) de 'p' elementos podemos formar a partir de 'n'?
                                <br><code>A<sub>n,p</sub> = n! / (n-p)!</code>
                                <br><em>Ex: Pódio (1º, 2º) com 4 corredores (n=4, p=2) -> 4! / (4-2)! = 24 / 2 = 12 pódios.</em>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-combinacao">
                <div class="summary">Combinação (A Ordem NÃO Importa)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Usamos quando a <strong>ordem</strong> dos elementos <strong>NÃO importa</strong>.</p>
                        <ul>
                            <li><strong><span class="term" data-description="Usado para escolher 'p' elementos de 'n', onde a ordem não importa. Fórmula: C(n,p) = n! / (p! * (n-p)!)">Combinação Simples (C<sub>n,p</sub>)</span>:</strong> Quantos grupos (comissões, times) de 'p' elementos podemos formar a partir de 'n'?
                                <br><code>C<sub>n,p</sub> = n! / (p! * (n-p)!)</code>
                            </li>
                            <li><em>Ex: Comissão de 2 pessoas com 4 corredores (n=4, p=2). {A,B} é a mesma comissão que {B,A}.</em>
                                <br><em>C<sub>4,2</sub> = 4! / (2! * 2!) = 24 / (2 * 2) = 6 comissões.</em>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-prob-combinatoria">
                <div class="summary">Usando Combinatória na Probabilidade</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Em muitos problemas, usamos Combinação para achar 'f' e 'n'.</p>
                        <p class="text-center font-medium my-4 p-4 bg-gray-800 rounded-lg">
                            P(A) = <span class="text-lg">C(favoráveis) / C(total)</span>
                        </p>
                        <p class="font-semibold text-gray-300 mt-4">Exemplo (Mega-Sena):</p>
                        <p>P(Acertar as 6 dezenas jogando 1 cartão de 6 números)?</p>
                        <ul>
                            <li><strong>Total de Casos (n):</strong> Quantos grupos de 6 números podemos formar com 60 disponíveis? A ordem não importa.
                                <br><code>n = C(60, 6) = 50.063.860</code>
                            </li>
                            <li><strong>Casos Favoráveis (f):</strong> Só existe 1 resultado que ganha (os 6 números sorteados).
                                <br><code>f = 1</code>
                            </li>
                            <li><strong>Probabilidade:</strong> P = 1 / 50.063.860</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="probabilidade-avancada" class="section-container">
         <div class="section-header-card">
            <h2 class="section-title">Probabilidade (Parte 2): Tópicos Avançados</h2>
            <p class="section-subtitle">Indo além do básico: como um evento afeta outro? Explore Probabilidade Condicional, Teorema do Produto e Independência.</p>
        </div>
        <div class="topics-grid">
            <div class="topic-card" id="topic-prob-condicional">
                <div class="summary">Probabilidade Condicional ("Sabendo que...")</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>É a probabilidade de um evento A ocorrer, <strong>dado que</strong> um evento B <strong>já ocorreu</strong>.</p>
                        <p>A informação "B ocorreu" <span class="term" data-description="Na probabilidade condicional, o 'Total de Casos' deixa de ser S e passa a ser o evento B, que já ocorreu.">reduz o nosso espaço amostral</span>. O novo "universo" é B.</p>
                        <p class="text-center font-medium my-4 p-4 bg-gray-800 rounded-lg">
                           <span class="text-lg">P(A | B) = P(A ∩ B) / P(B)</span>
                           <br>
                           <span class="text-base">(Lê-se: Probabilidade de A, dado B)</span>
                        </p>
                        <p class="font-semibold text-gray-300 mt-4">Exemplo (Tabela):</p>
                        <p>P(Ser de Produção | Sabendo que foi Aprovado)?</p>
                        <ul>
                            <li><strong>Novo Total (Denominador):</strong> O total de Aprovados = 140 (dados do slide).</li>
                            <li><strong>Favoráveis (Numerador):</strong> Pessoas que são de Produção E Aprovados = 60.</li>
                            <li><strong>Probabilidade:</strong> P = 60 / 140 = 3 / 7.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-teorema-produto">
                <div class="summary">Eventos Sucessivos (Teorema do Produto)</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Usado para calcular a probabilidade de eventos em sequência (A <strong>E</strong> B), especialmente quando <strong>há dependência</strong> (sem reposição).</p>
                        <p>Deriva da fórmula condicional:</p>
                        <p class="text-center font-medium my-4 p-4 bg-gray-800 rounded-lg">
                           <span class="text-lg">P(A ∩ B) = P(A) × P(B | A)</span>
                        </p>
                        <p><em>(A probabilidade de A e B ocorrerem é a P(A) multiplicada pela P(B) sabendo que A já aconteceu).</em></p>
                        <p class="font-semibold text-gray-300 mt-4">Exemplo (Peças sem reposição):</p>
                        <p>10 peças, 3 defeituosas (D) e 7 perfeitas (P). P(tirar 2 perfeitas)?</p>
                        <ul>
                            <li>P(1ª P <strong>E</strong> 2ª P) = P(1ª P) × P(2ª P | 1ª P)</li>
                            <li>P(1ª P) = 7/10</li>
                            <li>P(2ª P | 1ª P) = 6/9 (Agora só restam 9 peças, 6 delas perfeitas)</li>
                            <li><strong>Probabilidade:</strong> (7/10) × (6/9) = 42/90 = 7/15.</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-eventos-independentes">
                <div class="summary">Eventos Independentes</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Dois eventos são independentes se a ocorrência de um <strong>não afeta</strong> a probabilidade do outro.</p>
                        <p>Neste caso, <code>P(B | A) = P(B)</code>.</p>
                        <p>Isso simplifica o Teorema do Produto para:</p>
                        <p class="text-center font-medium my-4 p-4 bg-gray-800 rounded-lg">
                           <span class="text-lg">P(A ∩ B) = P(A) × P(B)</span>
                        </p>
                        <p class="font-semibold text-gray-300 mt-4">Exemplo (Com reposição):</p>
                        <p>Extintor disponível (P=0.98), Ambulância disponível (P=0.92). P(ambos disponíveis)?</p>
                        <ul>
                            <li>São eventos independentes.</li>
                            <li><strong>Probabilidade:</strong> 0.98 × 0.92 = 0.9016 (ou 90,16%).</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="topic-card" id="topic-paradoxo-aniversario">
                <div class="summary">Curiosidade: O Paradoxo do Aniversário</div>
                <div class="topic-content-wrapper">
                    <div class="topic-content">
                        <p>Pergunta: "Quantas pessoas precisamos em uma sala para que a probabilidade de <i>pelo menos duas</i> delas fazerem aniversário no mesmo dia seja maior que 50%?"</p>
                        <p>A resposta intuitiva é alta (ex: 183), mas a resposta correta é surpreendentemente baixa: <strong>23 pessoas</strong>.</p>
                        <p><strong>Como calcular (para 23 pessoas):</strong></p>
                        <p>É um problema de <span class="term" data-description="P(Pelo Menos Um) = 1 - P(Nenhum). É mais fácil calcular o oposto.">evento complementar</span>.</p>
                        <ul>
                            <li>P(pelo menos 2 iguais) = 1 - P(todos diferentes)</li>
                            <li>P(todos diferentes) = (365/365) × (364/365) × (363/365) × ... × (343/365)</li>
                            <li>P(todos diferentes) ≈ 0.493</li>
                            <li>P(pelo menos 2 iguais) ≈ 1 - 0.493 = 0.507 (ou 50,7%)</li>
                        </ul>
                        <p>Com 30 pessoas, a chance já sobe para 70,6%!</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="quiz-section" class="section-container">
        <div class="section-header-card">
            <h2 class="section-title">Teste seu Conhecimento</h2>
            <p class="section-subtitle">Vamos ver o que você aprendeu! Responda às perguntas para testar sua compreensão sobre Probabilidade.</p>
        </div>

        <div id="quiz-area" class="w-full max-w-3xl flex flex-col items-center">
            
            <div id="progress-bar-container">
                <div id="progress-bar-fill" style="width: 0%;">0%</div>
            </div>
            <div id="progress-label">Progresso: 0 de 20 questões dominadas</div>

            <div id="quiz-container" class="quiz-container hidden">
                <button id="help-btn" title="Pedir Dica (Revela a Resolução)">?</button>
                <div id="question-counter-display">1/10</div>
                <h3 id="quiz-question"></h3>
                <ul id="quiz-options"></ul>
            </div>

            <div id="quiz-results" class="quiz-container hidden">
                <h3>Quiz Finalizado!</h3>
                <div id="quiz-percentage">100%</div>
                <div class="results-stats">
                    <span id="stat-correct-count" class="stat-correct"></span>
                    <span id="stat-incorrect-count" class="stat-incorrect"></span>
                </div>
                <h4 class="text-lg font-semibold mt-6 mb-2 text-gray-300">Tópicos para revisar:</h4>
                <ul id="missed-topics-list"></ul>
                 <button id="restart-quiz-btn">Novo Quiz</button>
            </div>

            <div id="start-area" class="flex flex-col items-center">
                 <button id="quiz-start-btn">Começar Quiz</button>
                 <button id="reset-progress-btn">Zerar Progresso</button>
            </div>

        </div>
    </section>

    <footer class="footer-signature">
        <p>Interface original por Rafael Chaves Sebe. Conteúdo adaptado dos slides da Prof. Roberta de Amorim Ferreira (IFMG).</p>
    </footer>

    <!-- Modal (Dark) -->
    <div id="modal-overlay" class="fixed inset-0">
        <div id="modal-content" class="relative">
             <button id="modal-close-btn" class="absolute top-4 right-4 z-20">&times;</button>
            <div id="modal-header" class="relative hidden">
                <h3 id="modal-title"></h3>
            </div>
            <div id="modal-image-container" class="hidden">
            </div>
            <div id="modal-description"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Observer for section background changes
            const bgObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    const glowId = `bg-${entry.target.id}`;
                    const glowEl = document.getElementById(glowId);
                    if (glowEl) {
                        if (entry.isIntersecting) {
                            glowEl.style.opacity = '0.25';
                        } else {
                            glowEl.style.opacity = '0';
                        }
                    }
                });
            }, { threshold: 0.4 }); 

            document.querySelectorAll('#conceitos-fundamentais, #analise-combinatoria, #probabilidade-avancada').forEach(section => {
                bgObserver.observe(section);
            });

            // Observer for card animations
            const cardObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, {
                threshold: 0.01 // Anima quando 1% do card está visível
            });
            document.querySelectorAll('.topic-card, .section-header-card').forEach(card => {
                cardObserver.observe(card);
            });

            // ===================================
            // == MODAL LOGIC (CUSTOM)
            // ===================================
            const modalOverlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            const modalHeader = document.getElementById('modal-header');
            const modalTitle = document.getElementById('modal-title');
            const modalDescription = document.getElementById('modal-description');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const modalImageContainer = document.getElementById('modal-image-container');

            function openModal(theme = 'conceitos') {
                // Limpa classes de tema antigas
                modalContent.classList.remove('theme-probabilidade', 'theme-avancado', 'theme-conceitos');
                modalHeader.classList.remove('theme-probabilidade', 'theme-avancado', 'theme-conceitos');
                
                // Adiciona novas classes de tema
                modalContent.classList.add(`theme-${theme}`);
                modalHeader.classList.add(`theme-${theme}`);

                modalOverlay.classList.add('visible');
                document.body.style.overflow = 'hidden';
            }

            const closeModal = () => {
                modalOverlay.classList.remove('visible');
                setTimeout(() => {
                    if (!modalOverlay.classList.contains('visible')) {
                         document.body.style.overflow = '';
                         modalImageContainer.innerHTML = '';
                         // Limpa conteúdo para não vazar em info/confirm modals
                         modalTitle.textContent = '';
                         modalDescription.innerHTML = '';
                         modalHeader.classList.add('hidden');
                         modalImageContainer.classList.add('hidden');
                    }
                }, 400); 
            };
            
            function openInfoModal(message, title = "Aviso", theme = 'conceitos') {
                modalHeader.classList.remove('hidden');
                modalImageContainer.classList.add('hidden');
                
                modalTitle.textContent = title;
                modalDescription.innerHTML = message; // Usar innerHTML para tags <br> e <strong>
                
                openModal(theme);
            }

            function openConfirmModal(message, onConfirm) {
                modalHeader.classList.remove('hidden');
                modalImageContainer.classList.add('hidden');
                
                modalTitle.textContent = "Confirmação";
                modalDescription.innerHTML = `<p class="mb-4">${message}</p>`;
                
                const buttonGroup = document.createElement('div');
                buttonGroup.className = 'modal-button-group';
                
                const confirmBtn = document.createElement('button');
                confirmBtn.className = 'modal-button modal-button-confirm';
                confirmBtn.textContent = 'Confirmar';
                
                const cancelBtn = document.createElement('button');
                cancelBtn.className = 'modal-button modal-button-cancel';
                cancelBtn.textContent = 'Cancelar';

                // Remove event listeners antigos para evitar chamadas múltiplas
                const newConfirmBtn = confirmBtn.cloneNode(true);
                const newCancelBtn = cancelBtn.cloneNode(true);
                
                newConfirmBtn.addEventListener('click', () => {
                    closeModal();
                    onConfirm();
                });
                
                newCancelBtn.addEventListener('click', closeModal);
                
                buttonGroup.appendChild(newCancelBtn);
                buttonGroup.appendChild(newConfirmBtn);
                modalDescription.appendChild(buttonGroup);
                
                openModal('conceitos');
            }

            // Event Listeners for Terms
            document.querySelectorAll('.term').forEach(term => {
                term.addEventListener('click', (event) => {
                    event.preventDefault();
                    const title = term.textContent;
                    const description = term.getAttribute('data-description');
                    const parentSection = term.closest('section');
                    let theme = 'probabilidade'; 
                    if (parentSection && parentSection.id) {
                       if (parentSection.id === 'analise-combinatoria') theme = 'conceitos';
                       if (parentSection.id === 'probabilidade-avancada') theme = 'avancado';
                    }
                    
                    modalContent.classList.remove('image-modal');
                    modalHeader.classList.remove('hidden');
                    modalImageContainer.classList.add('hidden');
                    
                    modalTitle.textContent = title;
                    modalDescription.textContent = description;
                    
                    openModal(theme);
                });
            });

            modalCloseBtn.addEventListener('click', closeModal);
            modalOverlay.addEventListener('click', (event) => {
                if (event.target === modalOverlay) closeModal();
            });
            
            // ===================================
            // == ACCORDION LOGIC
            // ===================================
            document.querySelectorAll('.topic-card .summary').forEach(summary => {
                summary.addEventListener('click', (e) => {
                    const card = e.currentTarget.parentElement;
                    toggleAccordion(card);
                });
            });

            function toggleAccordion(cardToToggle) {
                const contentWrapper = cardToToggle.querySelector('.topic-content-wrapper');
                const isOpen = cardToToggle.classList.contains('is-open');

                if (isOpen) {
                    contentWrapper.style.maxHeight = '0px';
                    cardToToggle.classList.remove('is-open');
                } else {
                    const content = cardToToggle.querySelector('.topic-content');
                    contentWrapper.style.maxHeight = content.scrollHeight + 'px';
                    cardToToggle.classList.add('is-open');
                }
            }
            
            // ===================================
            // == QUIZ LOGIC (ADAPTADO)
            // ===================================

            // NOVO BANCO DE QUESTÕES BASEADO NOS SLIDES
            const questionBank = [
                // Conceitos Fundamentais
                { 
                    id: 1, 
                    question: "Ao lançar dois dados comuns, qual a probabilidade de que a soma dos números seja 7?", 
                    topic: "Conceito-Chave: Probabilidade Clássica (Laplace)", 
                    options: ["1/6", "1/12", "7/36", "1/5"], 
                    correctAnswer: 0,
                    helpText: "<strong>Dica:</strong> Liste todas as 36 combinações possíveis (1,1), (1,2), ... (6,6).<br><br><strong>Resolução:</strong> O 'Espaço Amostral' (Total de Casos) é 6 × 6 = 36.<br>Os 'Casos Favoráveis' (soma = 7) são: (1,6), (2,5), (3,4), (4,3), (5,2), (6,1).<br>São 6 casos favoráveis.<br><strong>P = 6 / 36 = 1/6</strong>."
                },
                { 
                    id: 2, 
                    question: "Em 3 lances de uma moeda, qual a probabilidade de ocorrência de exatamente uma cara?", 
                    topic: "Conceito-Chave: Probabilidade Clássica (Laplace)", 
                    options: ["1/8", "1/3", "3/8", "1/2"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> Liste todos os resultados possíveis.<br><br><strong>Resolução:</strong> O 'Espaço Amostral' (Total) é 2 × 2 × 2 = 8 casos.<br> S = {CCC, CCK, CKC, CKK, KCC, KCK, KKC, KKK}.<br>Os 'Casos Favoráveis' (exatamente 1 cara) são: {CKK, KCK, KKC}.<br>São 3 casos favoráveis.<br><strong>P = 3 / 8</strong>."
                },
                {
                    id: 3, 
                    question: "Numa turma de 40 alunos, o número de rapazes excede o de moças em 12. Qual a P(de sortear uma moça)?", 
                    topic: "Conceito-Chave: Probabilidade Clássica (Laplace)", 
                    options: ["1/40", "12/40", "7/20", "1/2"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> Monte um sistema de equações. R + M = 40 e R = M + 12.<br><br><strong>Resolução:</strong> Substituindo a 2ª na 1ª: (M + 12) + M = 40.<br>2M = 28 -> M = 14 moças.<br>(R = 14 + 12 = 26 rapazes).<br>Total de Casos (n) = 40.<br>Casos Favoráveis (f) = 14.<br><strong>P = 14 / 40 = 7 / 20</strong>."
                },
                {
                    id: 4, 
                    question: "Um dado é viciado. P(Par) = 2 * P(Ímpar). As faces pares são equiprováveis entre si, assim como as ímpares. Qual a P(face 3)?", 
                    topic: "Conceito-Chave: Probabilidade Clássica (Laplace)", 
                    options: ["1/3", "2/3", "1/6", "1/9"], 
                    correctAnswer: 3,
                    helpText: "<strong>Dica:</strong> P(Par) + P(Ímpar) = 1.<br><br><strong>Resolução:</strong> 2*P(Ímpar) + P(Ímpar) = 1 -> 3*P(Ímpar) = 1 -> P(Ímpar) = 1/3.<br>O evento 'Ímpar' é {1, 3, 5}. Como são equiprováveis, P(1)=P(3)=P(5).<br>P(1)+P(3)+P(5) = P(Ímpar) = 1/3.<br>3 * P(3) = 1/3 -> <strong>P(3) = 1/9</strong>."
                },
                // Operações com Eventos
                { 
                    id: 5, 
                    question: "No lançamento de 1 dado (S={1,2,3,4,5,6}), seja A={Par} e B={Sair nº maior que 4}. Qual é o evento A ∩ B (Interseção)?", 
                    topic: "Operações com Eventos (União, Interseção, Complemento)", 
                    options: ["{2, 4, 5, 6}", "{6}", "{5, 6}", "Ø"], 
                    correctAnswer: 1,
                    helpText: "<strong>Dica:</strong> Interseção (∩) significa 'E'. O resultado deve ser Par E maior que 4.<br><br><strong>Resolução:</strong> Evento A = {2, 4, 6}.<br>Evento B = {5, 6}.<br>O único elemento que está em A e B ao mesmo tempo é o 6.<br><strong>A ∩ B = {6}</strong>."
                },
                { 
                    id: 6, 
                    question: "No lançamento de 1 dado (S={1,2,3,4,5,6}), seja A={1} e C={Par}. A e C são ditos:", 
                    topic: "Operações com Eventos (União, Interseção, Complemento)", 
                    options: ["Complementares", "Mutuamente Exclusivos", "Independentes", "União"], 
                    correctAnswer: 1,
                    helpText: "<strong>Dica:</strong> Eventos mutuamente exclusivos são aqueles que não podem ocorrer ao mesmo tempo.<br><br><strong>Resolução:</strong> Evento A = {1}.<br>Evento C = {2, 4, 6}.<br>A interseção A ∩ C = Ø (conjunto vazio).<br>Como a interseção é vazia, eles são <strong>Mutuamente Exclusivos</strong>."
                },
                { 
                    id: 7, 
                    question: "Se P(Série)=0.72, P(Cinema)=0.55, e P(Série OU Cinema)=0.85. Qual a P(Série E Cinema)?", 
                    topic: "Teoremas Importantes (Regra da Soma, Complementar)", 
                    options: ["1.27", "0.15", "0.42", "0.30"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> Use a Regra da Soma: P(A ∪ B) = P(A) + P(B) - P(A ∩ B).<br><br><strong>Resolução:</strong> 0.85 = 0.72 + 0.55 - P(S ∩ C).<br>0.85 = 1.27 - P(S ∩ C).<br>P(S ∩ C) = 1.27 - 0.85 = <strong>0.42</strong>."
                },
                { 
                    id: 8, 
                    question: "Se 85% dos alunos veem Série OU vão ao Cinema (P(S∪C)=0.85), qual a P(de um aluno NÃO ver série E NÃO ir ao cinema)?", 
                    topic: "Teoremas Importantes (Regra da Soma, Complementar)", 
                    options: ["15%", "28%", "42%", "Impossível saber"], 
                    correctAnswer: 0,
                    helpText: "<strong>Dica:</strong> 'Não S OU Não C' é o complementar de 'S OU C'. P( (S∪C)ᶜ ).<br><br><strong>Resolução:</strong> Pela Regra do Complementar: P(Aᶜ) = 1 - P(A).<br>P( (S∪C)ᶜ ) = 1 - P(S∪C).<br>P = 1 - 0.85 = <strong>0.15 (ou 15%)</strong>."
                },
                { 
                    id: 9, 
                    question: "Se A e B são mutuamente exclusivos, P(A∪B) é:", 
                    topic: "Outras Definições: Frequência Relativa e Axiomática", 
                    options: ["P(A) + P(B) - P(A∩B)", "P(A) × P(B)", "P(A) + P(B)", "0"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> Este é o 3º Axioma da Probabilidade.<br><br><strong>Resolução:</strong> Se A e B são mutuamente exclusivos, a interseção P(A∩B) é 0. A Regra da Soma P(A∪B) = P(A) + P(B) - P(A∩B) se simplifica para <strong>P(A) + P(B)</strong>."
                },
                // Análise Combinatória
                { 
                    id: 10, 
                    question: "Qual a probabilidade de ganhar na Mega-Sena (6 números) com uma aposta simples (6 números) em 60 disponíveis?", 
                    topic: "Usando Combinatória na Probabilidade", 
                    options: ["1 / 50.063.860", "6 / 60", "1 / 360", "1 / 720"], 
                    correctAnswer: 0,
                    helpText: "<strong>Dica:</strong> A ordem dos números não importa, use Combinação.<br><br><strong>Resolução:</strong> Total de Casos (n) = Quantos grupos de 6 podemos formar com 60? n = C(60, 6).<br>C(60, 6) = 60! / (6! * 54!) = 50.063.860.<br>Casos Favoráveis (f) = 1 (só existe 1 resultado).<br><strong>P = 1 / 50.063.860</strong>."
                },
                { 
                    id: 11, 
                    question: "Uma senha é formada por 4 letras distintas do alfabeto (26 letras). Você lembra que começa com K e termina com W. Qual a P(acertar de 1ª)?", 
                    topic: "Usando Combinatória na Probabilidade", 
                    options: ["1/26", "1/650", "1/600", "1/552"], 
                    correctAnswer: 3,
                    helpText: "<strong>Dica:</strong> Use o PFC (Arranjo) para o 'Total de Casos'. A senha é K _ _ W.<br><br><strong>Resolução:</strong> O 'Total de Casos' é o número de senhas que se encaixam na dica.<br>Pos 1: K (1 opção).<br>Pos 4: W (1 opção).<br>Pos 2: 24 opções (não pode ser K nem W).<br>Pos 3: 23 opções (não pode ser K, W, nem a da Pos 2).<br>Total = 1 × 24 × 23 × 1 = 552.<br>Casos Favoráveis = 1 (a sua senha).<br><strong>P = 1 / 552</strong>."
                },
                { 
                    id: 12, 
                    question: "Um grupo tem 5 Homens e 3 Mulheres. Qual a P(de se escolher 2 pessoas e ambas serem mulheres)?", 
                    topic: "Usando Combinatória na Probabilidade", 
                    options: ["3/28", "1/4", "3/8", "6/56"], 
                    correctAnswer: 0,
                    helpText: "<strong>Dica:</strong> A ordem não importa. P = C(favoráveis) / C(total).<br><br><strong>Resolução:</strong> Total de Casos (n) = Escolher 2 de 8 pessoas. n = C(8, 2) = 8! / (2! 6!) = (8*7)/2 = 28.<br>Casos Favoráveis (f) = Escolher 2 de 3 mulheres. f = C(3, 2) = 3! / (2! 1!) = 3.<br><strong>P = 3 / 28</strong>."
                },
                // Probabilidade Avançada (Condicional, Produto, Independência)
                { 
                    id: 13, 
                    question: "Na tabela (Eng. Produção/Civil vs Aprov/Reprov), qual a P(aluno ser de Produção, DADO QUE foi aprovado)?", 
                    topic: "Probabilidade Condicional ('Sabendo que...')", 
                    options: ["60/110", "60/200", "60/140", "140/200"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> 'Dado que foi aprovado' reduz o universo. O novo total é 140.<br><br><strong>Resolução:</strong> O espaço amostral é reduzido para 'Aprovados' (n=140).<br>Dentro desse grupo, os 'Favoráveis' (Produção) são 60.<br><strong>P = 60 / 140 = 6 / 14 = 3 / 7</strong>. (A opção 60/140 é a correta)."
                },
                { 
                    id: 14, 
                    question: "Na mesma tabela, qual a P(aluno ser Aprovado, DADO QUE é de Eng. Civil)?", 
                    topic: "Probabilidade Condicional ('Sabendo que...')", 
                    options: ["80/90", "80/140", "80/200", "90/200"], 
                    correctAnswer: 0,
                    helpText: "<strong>Dica:</strong> 'Dado que é de Eng. Civil' reduz o universo. O novo total é 90.<br><br><strong>Resolução:</strong> O espaço amostral é reduzido para 'Eng. Civil' (n=90).<br>Dentro desse grupo, os 'Favoráveis' (Aprovados) são 80.<br><strong>P = 80 / 90 = 8 / 9</strong>. (A opção 80/90 é a correta)."
                },
                { 
                    id: 15, 
                    question: "Uma caixa tem 20 peças (5 Defeituosas, 15 Perfeitas). Extraem-se 2 SEM reposição. Qual a P(ambas serem perfeitas)?", 
                    topic: "Eventos Sucessivos (Teorema do Produto)", 
                    options: ["(15/20) * (15/20)", "(15/20) * (14/19)", "(5/20) * (4/19)", "15/20"], 
                    correctAnswer: 1,
                    helpText: "<strong>Dica:</strong> São eventos dependentes. P(A ∩ B) = P(A) × P(B | A).<br><br><strong>Resolução:</strong> P(1ª Perfeita E 2ª Perfeita).<br>P(1ª P) = 15/20.<br>P(2ª P | 1ª P) = 14/19 (Restam 19 peças, 14 perfeitas).<br><strong>P = (15/20) × (14/19)</strong> = 210 / 380 = 21/38."
                },
                { 
                    id: 16, 
                    question: "Uma urna tem 2B, 3P, 4V (Total 9). Retiram-se 2 SEM reposição. Qual a P(ambas serem verdes)?", 
                    topic: "Eventos Sucessivos (Teorema do Produto)", 
                    options: ["4/9", "16/81", "1/6", "12/81"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> Eventos dependentes. P(A ∩ B) = P(A) × P(B | A).<br><br><strong>Resolução:</strong> P(1ª V E 2ª V).<br>P(1ª V) = 4/9.<br>P(2ª V | 1ª V) = 3/8 (Restam 8 bolas, 3 verdes).<br><strong>P = (4/9) × (3/8) = 12 / 72 = 1/6</strong>."
                },
                { 
                    id: 17, 
                    question: "Um extintor tem P(disponível)=0.98 e uma ambulância P(disponível)=0.92. Os eventos são independentes. Qual a P(AMBOS estarem disponíveis)?", 
                    topic: "Eventos Independentes", 
                    options: ["0.98 + 0.92", "0.98", "1.00", "0.9016"], 
                    correctAnswer: 3,
                    helpText: "<strong>Dica:</strong> Para eventos independentes, P(A ∩ B) = P(A) × P(B).<br><br><strong>Resolução:</strong> P(Extintor E Ambulância).<br>P = P(Extintor) × P(Ambulância).<br><strong>P = 0.98 × 0.92 = 0.9016</strong> (ou 90.16%)."
                },
                { 
                    id: 18, 
                    question: "Em um grupo de 30 pessoas, a P(pelo menos duas terem o mesmo aniversário) é:", 
                    topic: "Curiosidade: O Paradoxo do Aniversário", 
                    options: ["Abaixo de 20%", "Entre 20% e 50%", "Acima de 70%", "Exatamente 50%"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> Este é o Paradoxo do Aniversário. O resultado é surpreendentemente alto.<br><br><strong>Resolução:</strong> P(Pelo menos 2 iguais) = 1 - P(Todos diferentes).<br>Com 23 pessoas, a P > 50%.<br>Com 30 pessoas, a P é <strong>70.63%</strong> (conforme slide 15), que é 'Acima de 70%'."
                },
                { 
                    id: 19, 
                    question: "Um teste de Dengue é 95% acurado. 10% da população está infectada. Qual a P(teste dar Negativo | indivíduo ESTÁ com dengue)?", 
                    topic: "Probabilidade Condicional ('Sabendo que...')", 
                    options: ["95%", "10%", "5%", "85.5%"], 
                    correctAnswer: 2,
                    helpText: "<strong>Dica:</strong> 'Acurado' significa que dá o resultado correto (Positivo para quem tem, Negativo para quem não tem).<br><br><strong>Resolução:</strong> O teste é 95% acurado.<br>Se o indivíduo ESTÁ com dengue, o teste 'correto' seria 'Positivo' (com 95% de chance).<br>O resultado 'incorreto' (Negativo) terá a probabilidade complementar.<br>P(Negativo | Com Dengue) = 100% - P(Positivo | Com Dengue) = 100% - 95% = <strong>5%</strong>."
                },
                { 
                    id: 20, 
                    question: "Urna 5V, 3B. Tira 1 (sem repor). Coloca 2 da *outra* cor. Tira 2ª bola. Qual a P(2ª bola ser Vermelha)?", 
                    topic: "Probabilidade Condicional ('Sabendo que...')", 
                    options: ["5/8", "41/72", "20/72", "21/72"], 
                    correctAnswer: 1,
                    helpText: "<strong>Dica:</strong> Use a Lei da Probabilidade Total. Separe em 2 casos: (1ª foi V) ou (1ª foi B).<br><br><strong>Resolução:</strong><br><strong>Caso 1:</strong> 1ª V (P=5/8). Urna fica 4V, 5B (Total 9). P(2ª V | 1ª V) = 4/9.<br>P(Caso 1 ∩ 2ªV) = (5/8)*(4/9) = 20/72.<br><strong>Caso 2:</strong> 1ª B (P=3/8). Urna fica 7V, 2B (Total 9). P(2ª V | 1ª B) = 7/9.<br>P(Caso 2 ∩ 2ªV) = (3/8)*(7/9) = 21/72.<br><strong>P(Total 2ªV)</strong> = (20/72) + (21/72) = <strong>41/72</strong>."
                }
            ];

            const TOTAL_QUESTIONS = questionBank.length; // 20

            const startBtn = document.getElementById('quiz-start-btn');
            const restartBtn = document.getElementById('restart-quiz-btn');
            const resetBtn = document.getElementById('reset-progress-btn'); 
            const startArea = document.getElementById('start-area');
            const quizContainer = document.getElementById('quiz-container');
            const resultsContainer = document.getElementById('quiz-results');
            const questionEl = document.getElementById('quiz-question');
            const optionsEl = document.getElementById('quiz-options');
            const questionCounterDisplay = document.getElementById('question-counter-display');
            const progressBarFill = document.getElementById('progress-bar-fill');
            const progressLabel = document.getElementById('progress-label');
            const helpBtn = document.getElementById('help-btn');
            
            let currentQuestionIndex = 0;
            let score = 0;
            let missedTopics = [];
            let activeQuiz = [];
            let correctlyAnsweredIds = [];
            
            // Nova chave de progresso para o novo quiz
            const PROGRESS_KEY = 'probabilidade_quiz_progress_v2'; 

            function loadProgress() {
                const savedProgress = localStorage.getItem(PROGRESS_KEY);
                correctlyAnsweredIds = savedProgress ? JSON.parse(savedProgress) : [];
                updateProgressBar();
                checkCompletion();
            }

            function saveProgress() {
                localStorage.setItem(PROGRESS_KEY, JSON.stringify(correctlyAnsweredIds));
            }

            function updateProgressBar() {
                const totalQuestions = TOTAL_QUESTIONS;
                const answeredCount = correctlyAnsweredIds.length;
                const percentage = totalQuestions > 0 ? Math.round((answeredCount / totalQuestions) * 100) : 0;
                
                progressBarFill.style.width = `${percentage}%`;
                progressBarFill.textContent = `${percentage}%`;
                progressLabel.textContent = `Progresso: ${answeredCount} de ${totalQuestions} questões dominadas`;
            }
            
            function checkCompletion() {
                const availableQuestions = questionBank.filter(q => !correctlyAnsweredIds.includes(q.id));
                if (availableQuestions.length === 0) {
                    startBtn.disabled = true;
                    startBtn.textContent = "Parabéns, você dominou tudo!";
                } else {
                    startBtn.disabled = false;
                    startBtn.textContent = "Começar Quiz";
                }
            }
            
            function startQuiz() {
                const availableQuestions = questionBank.filter(q => !correctlyAnsweredIds.includes(q.id));
                
                if (availableQuestions.length === 0) {
                     checkCompletion();
                     return;
                }

                // O quiz terá 10 perguntas, sorteadas das disponíveis
                activeQuiz = [...availableQuestions].sort(() => 0.5 - Math.random()).slice(0, 10);
                
                currentQuestionIndex = 0;
                score = 0;
                missedTopics = [];
                
                startArea.classList.add('hidden');
                resultsContainer.classList.add('hidden');
                quizContainer.classList.remove('hidden');
                showQuestion();
            }

            function showQuestion() {
                resetState();
                if (currentQuestionIndex >= activeQuiz.length) {
                    showResults();
                    return;
                }
                const questionData = activeQuiz[currentQuestionIndex];

                questionCounterDisplay.textContent = `${currentQuestionIndex + 1}/${activeQuiz.length}`;
                questionEl.textContent = questionData.question;
                
                questionData.options.forEach((option, index) => {
                    const li = document.createElement('li');
                    li.textContent = option;
                    li.classList.add('quiz-option');
                    li.dataset.index = index;
                    li.addEventListener('click', selectAnswer);
                    optionsEl.appendChild(li);
                });
            }

            function resetState() {
                while(optionsEl.firstChild) {
                    optionsEl.removeChild(optionsEl.firstChild);
                }
                document.body.classList.remove('correct-bg', 'incorrect-bg');
            }
            
            function selectAnswer(e) {
                const selectedOption = e ? e.target : null;
                Array.from(optionsEl.children).forEach(option => option.removeEventListener('click', selectAnswer));

                const currentQuestion = activeQuiz[currentQuestionIndex];
                const correctIndex = currentQuestion.correctAnswer;
                let isCorrect = false;

                if(selectedOption && parseInt(selectedOption.dataset.index) === correctIndex) {
                    isCorrect = true;
                }
                
                Array.from(optionsEl.children).forEach((optionNode, index) => {
                    optionNode.classList.add('disabled');
                    if (index === correctIndex) {
                        optionNode.classList.add('correct-answer');
                    }
                });

                if (isCorrect) {
                    score++;
                    if(selectedOption) selectedOption.classList.add('correct-answer');
                    document.body.classList.add('correct-bg');
                    if (!correctlyAnsweredIds.includes(currentQuestion.id)) {
                        correctlyAnsweredIds.push(currentQuestion.id);
                        saveProgress();
                        updateProgressBar();
                    }
                } else {
                    if (selectedOption) {
                        selectedOption.classList.add('incorrect-answer');
                    }
                    missedTopics.push(currentQuestion.topic);
                    document.body.classList.add('incorrect-bg');
                }

                setTimeout(() => {
                    currentQuestionIndex++;
                    if(currentQuestionIndex < activeQuiz.length) {
                        showQuestion();
                    } else {
                        showResults();
                    }
                }, 2500); 
            }
            
            function showResults() {
                resetState();
                quizContainer.classList.add('hidden');
                resultsContainer.classList.remove('hidden');

                const percentage = activeQuiz.length > 0 ? Math.round((score / activeQuiz.length) * 100) : 0;
                document.getElementById('quiz-percentage').textContent = `${percentage}%`;
                document.getElementById('stat-correct-count').textContent = `✔️ ${score} Acertos`;
                document.getElementById('stat-incorrect-count').textContent = `❌ ${activeQuiz.length - score} Erros`;
                
                const missedListEl = document.getElementById('missed-topics-list');
                missedListEl.innerHTML = '';
                
                if (missedTopics.some(t => t)) {
                     const uniqueMissedTopics = [...new Set(missedTopics.filter(t => t))];
                     uniqueMissedTopics.forEach(topicName => {
                         const targetCard = Array.from(document.querySelectorAll('.topic-card .summary'))
                             .find(s => s.textContent.trim() === topicName)?.parentElement;
                         
                         if (targetCard) {
                             const bubble = document.createElement('li');
                             bubble.textContent = topicName;
                             bubble.classList.add('missed-topic-bubble');
                             bubble.addEventListener('click', (e) => {
                                 e.currentTarget.classList.add('visited-topic');
                                 targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                 if (!targetCard.classList.contains('is-open')) {
                                     toggleAccordion(targetCard);
                                 }
                             });
                             missedListEl.appendChild(bubble);
                         }
                     });
                } else {
                     const congrats = document.createElement('li');
                     if (activeQuiz.length > 0 && score === activeQuiz.length) {
                         congrats.textContent = "Parabéns, você acertou tudo!";
                         congrats.classList.add('text-green-400', 'font-semibold');
                     } else {
                         congrats.textContent = "Você não errou nenhuma questão com tópico associado. Bom trabalho!";
                     }
                     missedListEl.appendChild(congrats);
                }
                 checkCompletion();
            }
            
            function resetProgress() {
                openConfirmModal("Você tem certeza que deseja zerar todo o seu progresso? Esta ação não pode ser desfeita.", () => {
                    localStorage.removeItem(PROGRESS_KEY);
                    correctlyAnsweredIds = [];
                    updateProgressBar();
                    checkCompletion();
                    openInfoModal("Seu progresso foi zerado com sucesso!");
                });
            }

            // FUNÇÃO DE AJUDA ATUALIZADA
            function showHelpForQuestion() {
                if (currentQuestionIndex >= activeQuiz.length) return;
                
                const questionData = activeQuiz[currentQuestionIndex];
                const helpText = questionData.helpText;
                
                // Determina o tema do modal pela seção do tópico
                const topicName = questionData.topic;
                const targetCard = Array.from(document.querySelectorAll('.topic-card .summary'))
                    .find(s => s.textContent.trim() === topicName)?.parentElement;
                
                let theme = 'conceitos'; // Default
                if (targetCard) {
                    const parentSectionId = targetCard.closest('section').id;
                    if (parentSectionId === 'conceitos-fundamentais') theme = 'probabilidade';
                    if (parentSectionId === 'analise-combinatoria') theme = 'conceitos';
                    if (parentSectionId === 'probabilidade-avancada') theme = 'avancado';
                }
                
                openInfoModal(helpText, "Dica e Resolução", theme);
            }

            startBtn.addEventListener('click', startQuiz);
            restartBtn.addEventListener('click', () => {
                resultsContainer.classList.add('hidden');
                startArea.classList.remove('hidden');
                checkCompletion();
            });
            resetBtn.addEventListener('click', resetProgress);
            helpBtn.addEventListener('click', showHelpForQuestion);

            // Define o total de questões na label
            progressLabel.textContent = `Progresso: 0 de ${TOTAL_QUESTIONS} questões dominadas`;
            loadProgress();
        });
    </script>
</body>
</html>
